<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë¯¸êµ­ ì£¼ì‹ ë°ì¼ë¦¬ ë¦¬í¬íŠ¸ (09:00 ê°±ì‹ )</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- âœ… SNF ë””ìì¸ ì‹œìŠ¤í…œ: ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€ ì˜ì—­(ìƒ‰/íƒ€ì´í¬/ì¹´ë“œ/ì‚¬ì´ë“œë°” ë£° ìœ ì§€) -->
  <style>
    :root{
      --eui-primary:#0047AB;
      --eui-primary-light:#60A5FA;
      --eui-primary-dark:#003380;

      --eui-page-background:#F8FAFC;
      --eui-body-background:#F1F5F9;
      --eui-panel-background:#FFFFFF;
      --eui-panel-subdued:#F8FAFC;
      --eui-panel-highlight:#F1F5F9;

      --eui-border-base:#E2E8F0;
      --eui-border-light:#F1F5F9;
      --eui-border-strong:#CBD5E1;

      --eui-text-primary:#1E293B;
      --eui-text-secondary:#64748B;
      --eui-text-subdued:#94A3B8;
      --eui-text-disabled:#CBD5E1;

      --eui-success:#10B981;
      --eui-warning:#F59E0B;
      --eui-danger:#EF4444;
      --eui-accent:#8B5CF6;

      --chart-blue-1:#003380;
      --chart-blue-2:#0047AB;
      --chart-blue-3:#3B82F6;
      --chart-blue-4:#60A5FA;

      --chart-gray-1:#94A3B8;
      --chart-gray-2:#64748B;
      --chart-gray-3:#475569;
    }

    body{
      font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background:var(--eui-page-background);
      color:var(--eui-text-primary);
    }

    .sidebar{
      background: linear-gradient(180deg, #1E293B 0%, #0F172A 100%);
      box-shadow: 1px 0 0 rgba(255, 255, 255, 0.05);
      transition: transform 0.3s ease;
    }

    .sidebar-item{
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
      color: #94A3B8;
      border-radius: 8px;
    }

    .sidebar-item:hover{
      background: rgba(255, 255, 255, 0.08);
      border-left-color: #60A5FA;
      color: #E2E8F0;
    }

    .sidebar-item.active{
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.25) 0%, rgba(59, 130, 246, 0.08) 100%);
      border-left-color: #3B82F6;
      color: #FFFFFF;
      font-weight: 600;
    }

    /* âœ… ë¯¸ì„¸ ì¡°ì •(ìŠ¤í¬ë¡¤ ì „ì œ): ì¹´ë“œ/ë©”ì¸ íŒ¨ë”© ì•„ì£¼ ì‚´ì§ ì¶•ì†Œ */
    .card{
      background:#FFFFFF;
      border-radius:16px;
      padding:22px;             /* 24px -> 22px */
      box-shadow:0 1px 3px rgba(0,0,0,0.05);
      border:1px solid #F1F5F9;
    }
    .card-hover:hover{
      box-shadow:0 4px 12px rgba(0,0,0,0.08);
      transform:translateY(-2px);
      transition:all 0.2s ease;
    }

    .skeleton{
      background: linear-gradient(90deg, #F1F5F9 25%, #E2E8F0 50%, #F1F5F9 75%);
      background-size: 200% 100%;
      animation: loading 1.5s ease-in-out infinite;
      border-radius: 8px;
    }
    @keyframes loading{
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .fade-in{ animation: fadeIn 0.22s ease-in; }
    @keyframes fadeIn{
      from{ opacity:0; transform:translateY(8px); }
      to{ opacity:1; transform:translateY(0); }
    }

    .panel{ display:none; }
    .panel.active{ display:block; }

    .kpi-strip{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 12px;
    }
    @media (max-width:1024px){
      .kpi-strip{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    .kpi-mini{
      background: #FFFFFF;
      border: 1px solid #F1F5F9;
      border-radius: 16px;
      padding: 14px 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .kpi-mini .label{
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .06em;
      text-transform: uppercase;
      color: var(--eui-text-subdued);
    }
    .kpi-mini .value{
      margin-top: 6px;
      font-size: 18px;
      font-weight: 800;
      color: var(--eui-text-primary);
      line-height: 1.2;
    }
    .kpi-mini .sub{
      margin-top: 4px;
      font-size: 12px;
      color: var(--eui-text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* âœ… ìµœìƒë‹¨ KPI ì‹œê°í™”(ë‹¨ì–´ ìƒ‰ìƒ) */
    .tone-good{ color: var(--eui-success); }
    .tone-bad{ color: var(--eui-danger); }
    .tone-neutral{ color: #0F172A; } /* ê²€ì • ê³„ì—´ */

    @media (max-width:768px){
      .sidebar{
        position: fixed;
        left: 0; top: 0; bottom: 0;
        width: 280px;
        transform: translateX(-100%);
        z-index: 1000;
        box-shadow: none;
      }
      .sidebar.open{
        transform: translateX(0);
        box-shadow: 4px 0 24px rgba(0,0,0,0.15);
      }
      .main-content{ padding: 14px; } /* 16px -> 14px */
    }
  </style>
</head>

<body>
  <!-- ëª¨ë°”ì¼ í–„ë²„ê±° -->
  <button class="fixed top-4 left-4 z-[1001] bg-white p-3 rounded-xl border border-slate-200 shadow-sm md:hidden"
    onclick="toggleSidebar()"
    aria-label="ë©”ë‰´">
    <svg class="w-6 h-6 text-[#0047AB]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
  </button>
  <div id="overlay" class="fixed inset-0 bg-black/50 z-[999] hidden" onclick="closeSidebar()"></div>

  <div class="flex min-h-screen">
    <!-- ì‚¬ì´ë“œë°” -->
    <aside id="sidebar" class="sidebar w-72 p-5 flex flex-col sticky top-0 h-screen overflow-y-auto">
      <div class="mb-8">
        <h1 class="text-xl font-bold text-white mb-1">US Daily Report</h1>
        <p class="text-sm text-slate-400">ë§¤ì¼ 09:00 KST ìë™ ê°±ì‹ </p>
      </div>

      <nav class="flex-1">
        <ul class="space-y-2 text-[15px]">
          <li><button class="sidebar-item w-full text-left px-4 py-3 rounded-lg active" data-panel="p1" onclick="openPanel('p1', event)">ë°ì¼ë¦¬ ë¸Œë¦¬í•‘</button></li>
          <li><button class="sidebar-item w-full text-left px-4 py-3 rounded-lg" data-panel="p2" onclick="openPanel('p2', event)">ë§ˆì¼“ ìŠ¤ëƒ…ìƒ·</button></li>
          <li><button class="sidebar-item w-full text-left px-4 py-3 rounded-lg" data-panel="p3" onclick="openPanel('p3', event)">ì´‰ë§¤ / ì¼ì •</button></li>
          <li><button class="sidebar-item w-full text-left px-4 py-3 rounded-lg" data-panel="p4" onclick="openPanel('p4', event)">ë§¤í¬ë¡œ ì²´ë ¥</button></li>
          <li><button class="sidebar-item w-full text-left px-4 py-3 rounded-lg" data-panel="p5" onclick="openPanel('p5', event)">í—¤ë“œë¼ì¸ TOP5</button></li>
          <li><button class="sidebar-item w-full text-left px-4 py-3 rounded-lg" data-panel="p6" onclick="openPanel('p6', event)">ì‹¤ì  / ê°€ì´ë˜ìŠ¤</button></li>
          <li><button class="sidebar-item w-full text-left px-4 py-3 rounded-lg" data-panel="p7" onclick="openPanel('p7', event)">ì„¹í„° / ìˆ˜ê¸‰</button></li>
          <li><button class="sidebar-item w-full text-left px-4 py-3 rounded-lg" data-panel="p8" onclick="openPanel('p8', event)">ë‚´ ì¢…ëª© ì ê²€</button></li>
          <li><button class="sidebar-item w-full text-left px-4 py-3 rounded-lg" data-panel="p9" onclick="openPanel('p9', event)">ë¦¬ìŠ¤í¬ ì²´í¬</button></li>
        </ul>
      </nav>

      <div class="mt-auto pt-6 border-t border-slate-700/50">
        <div class="flex items-center justify-between mb-3">
          <p class="text-sm font-medium text-slate-300">ì–‘ë‘í‚¹ í˜•ë‹˜</p>
          <span class="text-xs px-2 py-0.5 bg-blue-500/20 text-blue-400 rounded">v3.1</span>
        </div>
        <p class="text-xs text-slate-500">data/latest.json</p>
        <p id="last-load-time" class="text-xs text-slate-500 mt-1">ë§ˆì§€ë§‰ ë¡œë“œ: -</p>
        <div class="mt-3 flex items-center justify-between gap-2">
          <span id="next-update" class="text-xs text-slate-500">ë‹¤ìŒ ê°±ì‹ : -</span>
          <button class="text-xs text-blue-400 font-semibold hover:underline" onclick="loadData(true)">ì§€ê¸ˆ ìƒˆë¡œê³ ì¹¨</button>
        </div>
      </div>
    </aside>

    <!-- ë©”ì¸(ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ) -->
    <main id="mainScroll" class="flex-1 p-7 overflow-auto bg-slate-50 main-content">
      <!-- ìƒë‹¨ í—¤ë” -->
      <div class="mb-6">
        <div class="flex items-start justify-between gap-4 flex-wrap">
          <div>
            <h2 class="text-3xl font-bold text-slate-800">ë¯¸êµ­ ì£¼ì‹ ë°ì¼ë¦¬ ë¦¬í¬íŠ¸</h2>
            <!-- âœ… ìš”ì²­: ì„œë¸Œí…ìŠ¤íŠ¸ ì‚­ì œ -->
          </div>
          <div class="text-right">
            <p class="text-xs text-slate-400">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</p>
            <p id="updatedAt" class="text-sm font-semibold text-slate-700">-</p>
          </div>
        </div>

        <!-- ìƒë‹¨ KPI ìŠ¤íŠ¸ë¦½ -->
        <div class="mt-6 kpi-strip">
          <div class="kpi-mini">
            <div class="label">Mood</div>
            <div id="kpiMood" class="value"><span class="skeleton inline-block h-6 w-24"></span></div>
            <div id="kpiMoodSub" class="sub"><span class="skeleton inline-block h-4 w-40"></span></div>
          </div>
          <div class="kpi-mini">
            <div class="label">Action</div>
            <div id="kpiAction" class="value"><span class="skeleton inline-block h-6 w-24"></span></div>
            <div id="kpiActionSub" class="sub"><span class="skeleton inline-block h-4 w-40"></span></div>
          </div>
          <div class="kpi-mini">
            <div class="label">S&P500</div>
            <div id="kpiSPX" class="value"><span class="skeleton inline-block h-6 w-28"></span></div>
            <div id="kpiSPXSub" class="sub"><span class="skeleton inline-block h-4 w-32"></span></div>
          </div>
          <div class="kpi-mini">
            <div class="label">US 10Y</div>
            <div id="kpiUS10Y" class="value"><span class="skeleton inline-block h-6 w-28"></span></div>
            <div id="kpiUS10YSub" class="sub"><span class="skeleton inline-block h-4 w-32"></span></div>
          </div>
        </div>

        <div class="mt-6">
          <p class="text-xs font-semibold uppercase tracking-wider text-slate-400">Current Category</p>
          <h3 id="panelTitle" class="text-xl font-bold text-slate-900 mt-1">ë°ì¼ë¦¬ ë¸Œë¦¬í•‘</h3>
        </div>
      </div>

      <!-- ë°ì¼ë¦¬ ë¸Œë¦¬í•‘ -->
      <section id="p1" class="panel active fade-in">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="card card-hover lg:col-span-2">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Today</p>
            <h4 class="text-xl font-bold text-slate-800 mb-4">ì˜¤ëŠ˜ í•œ ì¤„ ìš”ì•½</h4>
            <div id="oneLine" class="text-sm text-slate-600 leading-relaxed">
              <div class="skeleton h-6 w-3/4"></div>
            </div>

            <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-slate-50 border border-slate-100 rounded-xl p-4">
                <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2">ì‹œì¥ ë¶„ìœ„ê¸°</p>
                <div class="flex items-center gap-3 flex-wrap">
                  <span id="moodBadge" class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-semibold bg-slate-100 text-slate-600">ë¡œë”©â€¦</span>
                  <span id="moodReason" class="text-sm text-slate-600">-</span>
                </div>
              </div>
              <div class="bg-slate-50 border border-slate-100 rounded-xl p-4">
                <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2">ì˜¤ëŠ˜ í•  í–‰ë™</p>
                <div class="flex items-center gap-3 flex-wrap">
                  <span id="actionBadge" class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-700">ë¡œë”©â€¦</span>
                  <span id="actionNote" class="text-sm text-slate-600">-</span>
                </div>
              </div>
            </div>

            <div class="mt-5 bg-blue-50 border-l-4 border-blue-600 p-5 rounded-xl">
              <div class="flex items-start gap-4">
                <div class="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center flex-shrink-0">
                  <span class="text-xl">ğŸ’¡</span>
                </div>
                <div>
                  <h5 class="font-bold text-slate-800 mb-2">ì´ˆë³´ìš© ë©”ëª¨</h5>
                  <p class="text-sm text-slate-600 leading-relaxed" id="beginnerMemo">
                    â€œí–‰ë™ì€ 1ê°œë§Œ ê³ ë¥´ë©´ ë¼ìš”. ì˜¤ëŠ˜ì€ â€˜ê´€ë§â€™ì²˜ëŸ¼ í™•ì‹¤íˆ.â€
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="card card-hover">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Action Items</p>
            <h4 class="text-xl font-bold text-slate-800 mb-4">ì˜¤ëŠ˜ì˜ í•  ì¼ 3ê°œ</h4>
            <div id="todo3" class="space-y-3">
              <div class="skeleton h-8"></div>
              <div class="skeleton h-8"></div>
              <div class="skeleton h-8"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ë§ˆì¼“ ìŠ¤ëƒ…ìƒ· -->
      <section id="p2" class="panel fade-in">
        <div class="card card-hover">
          <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2">Overnight</p>
          <h4 class="text-xl font-bold text-slate-800">ì–´ì ¯ë°¤ ë¯¸êµ­ì‹œì¥ ê²°ê³¼</h4>
          <p class="text-sm text-slate-500 mt-1">ëŒ€í‘œ 3ì§€ìˆ˜ + VIX + í° íë¦„</p>

          <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mt-6" id="indexKpis">
            <div class="card"><div class="skeleton h-28"></div></div>
            <div class="card"><div class="skeleton h-28"></div></div>
            <div class="card"><div class="skeleton h-28"></div></div>
            <div class="card"><div class="skeleton h-28"></div></div>
          </div>

          <div class="mt-6 bg-slate-50 border border-slate-100 rounded-xl p-4">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2">Big Flow</p>
            <p id="overnightReason" class="text-sm text-slate-600 leading-relaxed">
              <span class="skeleton inline-block h-5 w-5/6"></span>
            </p>
          </div>

          <div class="mt-6 relative" style="height: 340px;">
            <canvas id="overnightChart"></canvas>
          </div>
          <p class="text-xs text-slate-400 mt-3">* ê¸°ë³¸: ìµœê·¼ 30ì¼</p>
        </div>
      </section>

      <!-- ì´‰ë§¤/ì¼ì • -->
      <section id="p3" class="panel fade-in">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="card card-hover">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Catalyst</p>
            <h4 class="text-xl font-bold text-slate-800 mb-1">ê²½ì œ ë°œí‘œ</h4>
            <p class="text-sm text-slate-500 mb-5">ëª‡ ì‹œì— ë­ê°€ ìˆë‹¤</p>
            <div id="econEvents" class="space-y-3">
              <div class="skeleton h-8"></div>
              <div class="skeleton h-8"></div>
              <div class="skeleton h-8"></div>
            </div>
          </div>

          <div class="card card-hover">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Fed</p>
            <h4 class="text-xl font-bold text-slate-800 mb-1">ì—°ì¤€ ì¼ì •</h4>
            <p class="text-sm text-slate-500 mb-5">ë°œì–¸/íšŒì˜/íšŒì˜ë¡</p>
            <div id="fedEvents" class="space-y-3">
              <div class="skeleton h-8"></div>
              <div class="skeleton h-8"></div>
              <div class="skeleton h-8"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ë§¤í¬ë¡œ ì²´ë ¥ -->
      <section id="p4" class="panel fade-in">
        <div class="card card-hover">
          <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Macro</p>
          <h4 class="text-xl font-bold text-slate-800 mb-1">ê¸ˆë¦¬ Â· ë‹¬ëŸ¬ Â· ìœ ê°€</h4>
          <p class="text-sm text-slate-500">ì‹œì¥ ì²´ë ¥ ì²´í¬</p>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6" id="macroKpis">
            <div class="card"><div class="skeleton h-28"></div></div>
            <div class="card"><div class="skeleton h-28"></div></div>
            <div class="card"><div class="skeleton h-28"></div></div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <div class="bg-white rounded-2xl border border-slate-100 p-4">
              <h5 class="text-lg font-bold text-slate-800 mb-3">ìµœê·¼ 30ì¼ ì¶”ì´</h5>
              <div class="relative" style="height: 320px;">
                <canvas id="macroLineChart"></canvas>
              </div>
            </div>
            <div class="bg-white rounded-2xl border border-slate-100 p-4">
              <h5 class="text-lg font-bold text-slate-800 mb-3">ì´ˆë³´ìš© í•´ì„</h5>
              <div class="space-y-3 text-sm text-slate-600">
                <div class="bg-slate-50 border border-slate-100 rounded-xl p-4">
                  <p class="font-semibold text-slate-800 mb-1">ë¯¸êµ­ êµ­ì±„ê¸ˆë¦¬</p>
                  <p id="bondHint">ì˜¬ë¼ê°€ë©´ ë³´í†µ ì£¼ì‹ì— ë¶€ë‹´ì¼ ë•Œê°€ ë§ìŒ</p>
                </div>
                <div class="bg-slate-50 border border-slate-100 rounded-xl p-4">
                  <p class="font-semibold text-slate-800 mb-1">ë‹¬ëŸ¬ê°’</p>
                  <p id="dollarHint">ê°•/ì•½ì´ ìˆ˜ì¶œê¸°ì—…, ê¸°ìˆ ì£¼ì— ì˜í–¥ ì¤„ ìˆ˜ ìˆìŒ</p>
                </div>
                <div class="bg-slate-50 border border-slate-100 rounded-xl p-4">
                  <p class="font-semibold text-slate-800 mb-1">ìœ ê°€</p>
                  <p id="oilHint">ì¸í”Œë ˆ(ë¬¼ê°€)ë‘ ì—°ê²°</p>
                </div>
              </div>
            </div>
          </div>

        </div>
      </section>

      <!-- í—¤ë“œë¼ì¸ TOP5 -->
      <section id="p5" class="panel fade-in">
        <div class="card card-hover">
          <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Headlines</p>
          <h4 class="text-xl font-bold text-slate-800 mb-1">ì˜¤ëŠ˜ì˜ í•µì‹¬ ë‰´ìŠ¤ 5ê°œ</h4>
          <p class="text-sm text-slate-500 mb-6">ë‚´ ì¢…ëª© ê´€ë ¨ì´ë©´ ìë™ â­ í‘œì‹œë¨</p>
          <div id="newsTop5" class="space-y-4">
            <div class="skeleton h-10"></div>
            <div class="skeleton h-10"></div>
            <div class="skeleton h-10"></div>
            <div class="skeleton h-10"></div>
            <div class="skeleton h-10"></div>
          </div>
        </div>
      </section>

      <!-- ì‹¤ì /ê°€ì´ë˜ìŠ¤ -->
      <section id="p6" class="panel fade-in">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="card card-hover">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Earnings</p>
            <h4 class="text-xl font-bold text-slate-800 mb-1">ì´ë²ˆì£¼ ì‹¤ì  ë°œí‘œ</h4>
            <p class="text-sm text-slate-500 mb-5">ë‚´ ì¢…ëª©ì´ë©´ ìë™ â­</p>
            <div id="earningsList" class="space-y-3">
              <div class="skeleton h-8"></div>
              <div class="skeleton h-8"></div>
              <div class="skeleton h-8"></div>
            </div>
          </div>

          <div class="card card-hover">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Movers</p>
            <h4 class="text-xl font-bold text-slate-800 mb-1">ì‹¤ì  í›„ ê¸‰ë“±ë½</h4>
            <p class="text-sm text-slate-500 mb-5">ì™œ ì›€ì§ì˜€ëŠ”ì§€ í•œ ì¤„</p>
            <div id="earningsMovers" class="space-y-3">
              <div class="skeleton h-8"></div>
              <div class="skeleton h-8"></div>
              <div class="skeleton h-8"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ì„¹í„°/ìˆ˜ê¸‰ -->
      <section id="p7" class="panel fade-in">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="card card-hover">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Sectors</p>
            <h4 class="text-xl font-bold text-slate-800 mb-1">ì„¹í„° ì„±ê³¼</h4>
            <p class="text-sm text-slate-500 mb-5">ëˆì´ ì–´ë””ë¡œ ëª°ë¦¬ëŠ”ì§€</p>
            <div class="relative" style="height: 340px;">
              <canvas id="sectorBar"></canvas>
            </div>
          </div>

          <div class="card card-hover">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Summary</p>
            <h4 class="text-xl font-bold text-slate-800 mb-5">TOP / BOTTOM</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-emerald-50 border border-emerald-100 rounded-xl p-4">
                <p class="text-xs font-semibold uppercase tracking-wider text-emerald-600 mb-2">TOP</p>
                <div id="sectorTop" class="space-y-2 text-sm text-slate-700">
                  <div class="skeleton h-6"></div>
                  <div class="skeleton h-6"></div>
                  <div class="skeleton h-6"></div>
                </div>
              </div>
              <div class="bg-red-50 border border-red-100 rounded-xl p-4">
                <p class="text-xs font-semibold uppercase tracking-wider text-red-600 mb-2">BOTTOM</p>
                <div id="sectorBottom" class="space-y-2 text-sm text-slate-700">
                  <div class="skeleton h-6"></div>
                  <div class="skeleton h-6"></div>
                  <div class="skeleton h-6"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ë‚´ ì¢…ëª© ì ê²€ -->
      <section id="p8" class="panel fade-in">
        <div class="mb-4">
          <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2">My List</p>
          <h4 class="text-xl font-bold text-slate-800">ë‚´ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ë¹ ë¥¸ ì ê²€</h4>
          <p class="text-sm text-slate-500 mt-1">4ì¤„ í…œí”Œë¦¿ ê·¸ëŒ€ë¡œ</p>
        </div>

        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
          <table class="w-full">
            <thead class="bg-slate-50 border-b border-slate-200">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider text-slate-500">ì¢…ëª©</th>
                <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider text-slate-500">4ì¤„ í…œí”Œë¦¿</th>
                <th class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider text-slate-500">ì˜¤ëŠ˜ ê°€ê²© íë¦„</th>
              </tr>
            </thead>
            <tbody id="myStocksBody" class="divide-y divide-slate-100">
              <tr><td class="px-6 py-4" colspan="3"><div class="skeleton h-10"></div></td></tr>
              <tr><td class="px-6 py-4" colspan="3"><div class="skeleton h-10"></div></td></tr>
              <tr><td class="px-6 py-4" colspan="3"><div class="skeleton h-10"></div></td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- ë¦¬ìŠ¤í¬ ì²´í¬ -->
      <section id="p9" class="panel fade-in">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="card card-hover">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Risk</p>
            <h4 class="text-lg font-bold text-slate-800 mb-3">ì†ë„(ê¸‰ë“±/ê¸‰ë½)</h4>
            <p id="riskSpeed" class="text-sm text-slate-600"><span class="skeleton inline-block h-5 w-5/6"></span></p>
          </div>
          <div class="card card-hover">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Volatility</p>
            <h4 class="text-lg font-bold text-slate-800 mb-3">ë³€ë™ì„±(ìš”ë™)</h4>
            <p id="riskVol" class="text-sm text-slate-600"><span class="skeleton inline-block h-5 w-5/6"></span></p>
          </div>
          <div class="card card-hover">
            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Rule</p>
            <h4 class="text-lg font-bold text-slate-800 mb-3">ë‚´ ê¸°ì¤€ ë£°</h4>
            <p id="riskRule" class="text-sm text-slate-600"><span class="skeleton inline-block h-5 w-5/6"></span></p>
          </div>
        </div>
      </section>

      <!-- âœ… ìš”ì²­: "* ë°ì´í„° ì†ŒìŠ¤..." ë¬¸êµ¬ ì‚­ì œ -->
      <div class="text-xs text-slate-400 py-8"></div>
    </main>
  </div>

<script>
  // Chart.js ê³µí†µ ì˜µì…˜
  Chart.defaults.font.family = "'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
  Chart.defaults.color = getComputedStyle(document.documentElement).getPropertyValue('--eui-text-secondary').trim();

  const commonChartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        labels: {
          color: getComputedStyle(document.documentElement).getPropertyValue('--eui-text-primary').trim(),
          padding: 12,
          font: { size: 11 },
          usePointStyle: true,
          pointStyle: 'circle'
        }
      },
      tooltip: {
        backgroundColor: 'rgba(255, 255, 255, 0.98)',
        titleColor: getComputedStyle(document.documentElement).getPropertyValue('--eui-text-primary').trim(),
        bodyColor: getComputedStyle(document.documentElement).getPropertyValue('--eui-text-secondary').trim(),
        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--eui-primary').trim(),
        borderWidth: 1,
        padding: 12,
        boxPadding: 6,
        usePointStyle: true,
        cornerRadius: 8
      }
    },
    scales: {
      x: { grid: { display: false }, ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--eui-text-secondary').trim() } },
      y: { grid: { color: getComputedStyle(document.documentElement).getPropertyValue('--eui-border-light').trim() },
           ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--eui-text-secondary').trim() } }
    }
  };

  const C = {
    blue1: getVar('--chart-blue-1'),
    blue2: getVar('--chart-blue-2'),
    blue3: getVar('--chart-blue-3'),
    blue4: getVar('--chart-blue-4'),
    gray1: getVar('--chart-gray-1'),
  };

  function getVar(name){
    return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
  }

  function fmtPct(x){
    if (x === null || x === undefined || x === '') return '-';
    const n = Number(x);
    if (Number.isNaN(n)) return String(x);
    const arrow = n >= 0 ? 'â†‘' : 'â†“';
    return `${arrow} ${Math.abs(n).toFixed(2)}%`;
  }

  function moodBadgeStyle(mood){
    if(mood === 'ì¢‹ìŒ') return 'bg-emerald-100 text-emerald-700';
    if(mood === 'ë‚˜ì¨') return 'bg-red-100 text-red-700';
    return 'bg-slate-100 text-slate-700';
  }
  function actionBadgeStyle(action){
    if(action.includes('ë§¤ìˆ˜')) return 'bg-blue-100 text-blue-700';
    if(action.includes('ì •ë¦¬')) return 'bg-red-100 text-red-700';
    if(action.includes('ê´€ë§')) return 'bg-slate-100 text-slate-700';
    return 'bg-slate-100 text-slate-700';
  }

  function escapeHtml(str){
    if(str === null || str === undefined) return '';
    return String(str)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'","&#039;");
  }

  function pctColorClass(x){
    const n = Number(x);
    if (Number.isNaN(n)) return 'text-slate-600 bg-slate-100';
    return n >= 0 ? 'text-emerald-600 bg-emerald-50' : 'text-red-600 bg-red-50';
  }

  function itemRow(time, title, note){
    return `
      <div class="flex items-start justify-between gap-4 p-3 rounded-lg hover:bg-slate-50 transition-all">
        <div>
          <p class="font-semibold text-slate-800">${escapeHtml(time)} Â· ${escapeHtml(title)}</p>
          <p class="text-xs text-slate-500">${escapeHtml(note || '')}</p>
        </div>
      </div>
    `;
  }

  function newsCard(n){
    const star = n.star ? 'â­ ' : '';
    return `
      <div class="p-4 rounded-xl border border-slate-100 hover:bg-slate-50 transition-all">
        <p class="font-semibold text-slate-800">${star}${escapeHtml(n.title)}</p>
        <p class="text-sm text-slate-600 mt-1">${escapeHtml(n.why || '')}</p>
        <p class="text-xs text-slate-400 mt-2">${escapeHtml(n.source || '')}</p>
      </div>
    `;
  }

  function kpiCard(icon, label, valueText, desc, changePct){
    return `
      <div class="card card-hover">
        <div class="flex items-start justify-between mb-4">
          <div class="w-12 h-12 rounded-xl bg-blue-50 flex items-center justify-center">
            <span class="text-2xl">${icon}</span>
          </div>
          <span class="text-xs font-medium text-slate-400 uppercase tracking-wider">${escapeHtml(label)}</span>
        </div>
        <h3 class="text-4xl font-bold text-slate-900 mb-2">${escapeHtml(valueText)}</h3>
        <p class="text-sm text-slate-500 mb-3">${escapeHtml(desc)}</p>
        <div class="flex items-center gap-2">
          <span class="inline-flex items-center gap-1 px-2 py-1 rounded-md text-sm font-semibold ${pctColorClass(changePct)}">
            ${fmtPct(changePct)}
          </span>
          <span class="text-xs text-slate-400">vs ì „ì¼</span>
        </div>
      </div>
    `;
  }

  function stockRow(s){
    const pct = Number(s.changePct);
    const color = Number.isNaN(pct) ? 'text-slate-600' : (pct >= 0 ? 'text-emerald-600' : 'text-red-600');

    const lines = [
      `1) ì˜¤ëŠ˜ ê°€ê²© íë¦„: ${escapeHtml(s.priceText || '-')}`,
      `2) ê´€ë ¨ ë‰´ìŠ¤: ${escapeHtml(s.news || 'ì—†ìŒ')}`,
      `3) ë‹¤ìŒ í° ì¼ì •: ${escapeHtml(s.nextEvent || 'ì—†ìŒ')}`,
      `4) ë‚´ ë©”ëª¨: ${escapeHtml(s.memo || '')}`
    ];

    return `
      <tr class="hover:bg-slate-50 transition-colors align-top">
        <td class="px-6 py-4">
          <p class="font-semibold text-slate-800">${escapeHtml(s.symbol)}</p>
          <p class="text-xs text-slate-500">${escapeHtml(s.name || '')}</p>
        </td>
        <td class="px-6 py-4">
          <div class="space-y-1 text-sm text-slate-600">
            ${lines.map(t => `<p>${t}</p>`).join('')}
          </div>
        </td>
        <td class="px-6 py-4 text-right">
          <p class="font-semibold text-slate-800">${escapeHtml(s.last || '-')}</p>
          <p class="text-sm font-semibold ${color}">${fmtPct(s.changePct)}</p>
        </td>
      </tr>
    `;
  }

  // âœ… KPI ë‹¨ì–´ í†¤(ì´ˆë¡/ë¹¨ê°•/ê²€ì •)
  function toneClassForMood(mood){
    if(mood === 'ì¢‹ìŒ') return 'tone-good';
    if(mood === 'ë‚˜ì¨') return 'tone-bad';
    return 'tone-neutral'; // ì• ë§¤ í¬í•¨
  }
  function toneClassForAction(action){
    if(!action) return 'tone-neutral';
    if(action.includes('ë§¤ìˆ˜')) return 'tone-good';
    if(action.includes('ì •ë¦¬')) return 'tone-bad';
    return 'tone-neutral'; // ê´€ë§/ìœ ì§€
  }

  const charts = { overnight:null, macro:null, sector:null };
  function destroyChart(key){
    if(charts[key] && typeof charts[key].destroy === 'function'){
      charts[key].destroy();
      charts[key] = null;
    }
  }
  function hexToRgba(hex, a){
    const h = hex.replace('#','');
    const r = parseInt(h.slice(0,2),16);
    const g = parseInt(h.slice(2,4),16);
    const b = parseInt(h.slice(4,6),16);
    return `rgba(${r}, ${g}, ${b}, ${a})`;
  }

  const panelTitles = {
    p1: 'ë°ì¼ë¦¬ ë¸Œë¦¬í•‘',
    p2: 'ë§ˆì¼“ ìŠ¤ëƒ…ìƒ·',
    p3: 'ì´‰ë§¤ / ì¼ì •',
    p4: 'ë§¤í¬ë¡œ ì²´ë ¥',
    p5: 'í—¤ë“œë¼ì¸ TOP5',
    p6: 'ì‹¤ì  / ê°€ì´ë˜ìŠ¤',
    p7: 'ì„¹í„° / ìˆ˜ê¸‰',
    p8: 'ë‚´ ì¢…ëª© ì ê²€',
    p9: 'ë¦¬ìŠ¤í¬ ì²´í¬'
  };

  function openPanel(id, ev){
    document.querySelectorAll('.sidebar-item').forEach(b => b.classList.remove('active'));
    if(ev?.currentTarget) ev.currentTarget.classList.add('active');

    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    const target = document.getElementById(id);
    if(target){
      target.classList.add('active');
      document.getElementById('panelTitle').textContent = panelTitles[id] || 'ë¦¬í¬íŠ¸';
      target.classList.remove('fade-in'); void target.offsetWidth; target.classList.add('fade-in');
    }

    const main = document.getElementById('mainScroll');
    if(main) main.scrollTo({ top: 0, behavior: 'smooth' });

    if(window.innerWidth < 768) closeSidebar();
  }

  function toggleSidebar(){
    document.getElementById('sidebar').classList.toggle('open');
    document.getElementById('overlay').classList.toggle('hidden');
  }
  function closeSidebar(){
    document.getElementById('sidebar').classList.remove('open');
    document.getElementById('overlay').classList.add('hidden');
  }

  // 09:00 KST ìë™ ë¦¬ë¡œë“œ(í”„ë¡ íŠ¸ ë³´ì¡°)
  function nextUpdateKST(){
    const now = new Date();
    const utc = now.getTime() + (now.getTimezoneOffset() * 60 * 1000);
    const kstNow = new Date(utc + 9 * 60 * 60 * 1000);

    const target = new Date(kstNow);
    target.setHours(9,0,10,0);
    if(kstNow.getTime() >= target.getTime()) target.setDate(target.getDate() + 1);

    const targetUtc = target.getTime() - 9 * 60 * 60 * 1000;
    const localTarget = new Date(targetUtc - (now.getTimezoneOffset() * 60 * 1000));
    return { targetKst: target, localTarget };
  }
  function formatKst(dtKst){
    const y = dtKst.getFullYear();
    const m = String(dtKst.getMonth()+1).padStart(2,'0');
    const d = String(dtKst.getDate()).padStart(2,'0');
    const hh = String(dtKst.getHours()).padStart(2,'0');
    const mm = String(dtKst.getMinutes()).padStart(2,'0');
    return `${y}-${m}-${d} ${hh}:${mm} KST`;
  }
  function scheduleAutoRefreshAt9(){
    const { targetKst, localTarget } = nextUpdateKST();
    const nextEl = document.getElementById('next-update');
    if(nextEl) nextEl.textContent = 'ë‹¤ìŒ ê°±ì‹ : ' + formatKst(targetKst);

    const delay = Math.max(0, localTarget.getTime() - Date.now());
    setTimeout(async ()=>{
      await loadData(true);
      scheduleAutoRefreshAt9();
    }, delay);

    setInterval(()=> loadData(true), 5 * 60 * 1000);
  }

  async function loadData(force=false){
    try{
      const res = await fetch('data/latest.json', { cache: force ? 'no-store' : 'default' });
      if(!res.ok) throw new Error('latest.json not found');
      const data = await res.json();
      renderAll(data);
    }catch(e){
      renderAll(sampleData());
    }
  }

  function buildSymbolSet(myStocks){
    const set = new Set();
    (myStocks || []).forEach(s=>{
      const sym = String(s.symbol || '').trim().toUpperCase();
      if(sym) set.add(sym);
    });
    return set;
  }
  function containsTicker(text, ticker){
    if(!text || !ticker) return false;
    const esc = ticker.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const re = new RegExp(`\\b${esc}\\b`, 'i');
    return re.test(text);
  }
  function applyAutoStars(data){
    const symbols = buildSymbolSet(data.myStocks);
    const list = data.newsTop5 || [];
    list.forEach(n=>{
      if(n.star) return;
      const blob = `${n.title||''} ${n.why||''} ${n.source||''}`;
      for(const sym of symbols){
        if(containsTicker(blob, sym)){
          n.star = true;
          break;
        }
      }
    });

    const upcoming = data.earnings?.upcoming || [];
    upcoming.forEach(x=>{
      const sym = String(x.symbol||'').toUpperCase();
      x._star = symbols.has(sym);
    });
  }

  function renderAll(data){
    applyAutoStars(data);

    document.getElementById('updatedAt').textContent = data.updatedAt || '-';
    document.getElementById('last-load-time').textContent = 'ë§ˆì§€ë§‰ ë¡œë“œ: ' + (data.updatedAt || '-');

    // KPI ìŠ¤íŠ¸ë¦½
    const mood = data.mood?.value || 'ì• ë§¤';
    const moodReason = data.mood?.reason || '-';
    const moodEl = document.getElementById('kpiMood');
    moodEl.textContent = mood;
    moodEl.className = `value ${toneClassForMood(mood)}`;
    document.getElementById('kpiMoodSub').textContent = moodReason;

    const action = data.action?.value || 'ê´€ë§';
    const actionNote = data.action?.note || '-';
    const actionEl = document.getElementById('kpiAction');
    actionEl.textContent = action;
    actionEl.className = `value ${toneClassForAction(action)}`;
    document.getElementById('kpiActionSub').textContent = actionNote;

    const okpis = data.overnight?.kpis || [];
    const spx = okpis.find(x => String(x.label||'').toLowerCase().includes('s&p')) || null;
    document.getElementById('kpiSPX').textContent = spx ? `${spx.valueText}` : '-';
    document.getElementById('kpiSPXSub').textContent = spx ? `ì „ì¼ ${fmtPct(spx.changePct)}` : '-';

    const mkpis = data.macro?.kpis || [];
    const us10y = mkpis.find(x => String(x.label||'').includes('10')) || null;
    document.getElementById('kpiUS10Y').textContent = us10y ? `${us10y.valueText}` : '-';
    document.getElementById('kpiUS10YSub').textContent = us10y ? `ì „ì¼ ${fmtPct(us10y.changePct)}` : '-';

    // p1
    document.getElementById('oneLine').textContent = data.oneLine || '-';

    const moodBadge = document.getElementById('moodBadge');
    moodBadge.className = `inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-semibold ${moodBadgeStyle(mood)}`;
    moodBadge.textContent = mood;
    document.getElementById('moodReason').textContent = moodReason;

    const actionBadge = document.getElementById('actionBadge');
    actionBadge.className = `inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-semibold ${actionBadgeStyle(action)}`;
    actionBadge.textContent = action;
    document.getElementById('actionNote').textContent = actionNote;
    document.getElementById('beginnerMemo').textContent = data.action?.beginnerMemo || document.getElementById('beginnerMemo').textContent;

    const todo = document.getElementById('todo3');
    const t = data.todo3 || [];
    todo.innerHTML = t.length ? t.slice(0,3).map((x,i)=>`
      <div class="flex items-center gap-3 p-3 rounded-lg hover:bg-slate-50 transition-all">
        <div class="w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center font-bold text-slate-800">${i+1}</div>
        <p class="text-sm text-slate-700 font-semibold">${escapeHtml(x)}</p>
      </div>
    `).join('') : `<p class="text-sm text-slate-500">ë°ì´í„° ì—†ìŒ</p>`;

    // p2
    const idxKpis = document.getElementById('indexKpis');
    idxKpis.innerHTML = okpis.length
      ? okpis.map(x => kpiCard(x.icon || 'ğŸ“ˆ', x.label, x.valueText, x.desc, x.changePct)).join('')
      : '';

    document.getElementById('overnightReason').textContent = data.overnight?.bigFlowReason || '-';

    destroyChart('overnight');
    const ov = data.overnight?.series || null;
    const ovCtx = document.getElementById('overnightChart');
    if(ovCtx && ov?.labels?.length){
      charts.overnight = new Chart(ovCtx, {
        type:'line',
        data:{
          labels: ov.labels,
          datasets:[
            { label:'S&P500', data: ov.spx || [], borderColor: C.blue2, backgroundColor:'rgba(0,71,171,0.10)', borderWidth:2.5, fill:true, tension:0.4, pointRadius:0 },
            { label:'ë‚˜ìŠ¤ë‹¥', data: ov.ixic || [], borderColor: C.blue3, backgroundColor:'rgba(59,130,246,0.08)', borderWidth:2.5, fill:true, tension:0.4, pointRadius:0 },
            { label:'ë‹¤ìš°', data: ov.dji || [], borderColor: C.gray1, backgroundColor:'rgba(148,163,184,0.06)', borderWidth:2.5, fill:true, tension:0.4, pointRadius:0 },
          ]
        },
        options: commonChartOptions
      });
    }

    // p3
    const econ = document.getElementById('econEvents');
    const fed = document.getElementById('fedEvents');
    const econList = data.schedule?.econ || [];
    const fedList = data.schedule?.fed || [];
    econ.innerHTML = econList.length ? econList.map(x => itemRow(x.time, x.title, x.note)).join('') : `<p class="text-sm text-slate-500">ë°ì´í„° ì—†ìŒ</p>`;
    fed.innerHTML  = fedList.length  ? fedList.map(x => itemRow(x.time, x.title, x.note)).join('') : `<p class="text-sm text-slate-500">ë°ì´í„° ì—†ìŒ</p>`;

    // p4
    const macroKpis = document.getElementById('macroKpis');
    macroKpis.innerHTML = mkpis.length ? mkpis.map(x => kpiCard(x.icon || 'ğŸ¦', x.label, x.valueText, x.desc, x.changePct)).join('') : '';

    destroyChart('macro');
    const m = data.macro?.series || null;
    const mCtx = document.getElementById('macroLineChart');
    if(mCtx && m?.labels?.length){
      charts.macro = new Chart(mCtx, {
        type:'line',
        data:{
          labels: m.labels,
          datasets:[
            { label:'ë¯¸êµ­ 10ë…„ ê¸ˆë¦¬', data: m.us10y || [], borderColor: C.blue1, backgroundColor:'rgba(0,51,128,0.08)', borderWidth:2.5, fill:true, tension:0.4, pointRadius:0 },
            { label:'ë‹¬ëŸ¬(DXY)', data: m.dxy || [], borderColor: C.blue3, backgroundColor:'rgba(59,130,246,0.06)', borderWidth:2.5, fill:true, tension:0.4, pointRadius:0 },
            { label:'WTI', data: m.wti || [], borderColor: C.gray1, backgroundColor:'rgba(148,163,184,0.06)', borderWidth:2.5, fill:true, tension:0.4, pointRadius:0 }
          ]
        },
        options: commonChartOptions
      });
    }

    // p5
    const news = document.getElementById('newsTop5');
    const nList = data.newsTop5 || [];
    news.innerHTML = nList.length ? nList.slice(0,5).map(newsCard).join('') : `<p class="text-sm text-slate-500">ë°ì´í„° ì—†ìŒ</p>`;

    // p6
    const el = document.getElementById('earningsList');
    const em = document.getElementById('earningsMovers');
    const upcoming = data.earnings?.upcoming || [];
    const movers = data.earnings?.movers || [];

    el.innerHTML = upcoming.length ? upcoming.map(x => {
      const star = x._star ? 'â­ ' : '';
      return itemRow(x.when, `${star}${x.symbol} Â· ${x.name}`, x.note);
    }).join('') : `<p class="text-sm text-slate-500">ë°ì´í„° ì—†ìŒ</p>`;

    em.innerHTML = movers.length ? movers.map(x => {
      const cls = x.changePct >= 0 ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-700';
      return `
        <div class="flex items-start justify-between gap-4 p-3 rounded-lg hover:bg-slate-50 transition-all">
          <div>
            <p class="font-semibold text-slate-800">${escapeHtml(x.symbol)} Â· ${escapeHtml(x.name)}</p>
            <p class="text-xs text-slate-500">${escapeHtml(x.why || '')}</p>
          </div>
          <span class="inline-flex items-center px-2 py-1 rounded-md text-sm font-semibold ${cls}">
            ${fmtPct(x.changePct)}
          </span>
        </div>
      `;
    }).join('') : `<p class="text-sm text-slate-500">ë°ì´í„° ì—†ìŒ</p>`;

    // p7
    destroyChart('sector');
    const sectors = data.sectors || [];
    const sCtx = document.getElementById('sectorBar');
    if(sCtx && sectors.length){
      const colors = sectors.length <= 4
        ? [C.blue1, C.blue2, C.blue3, C.blue4]
        : [C.blue1, C.blue2, C.blue3, C.blue4, getVar('--chart-gray-1'), getVar('--chart-gray-2'), getVar('--chart-gray-3')];

      charts.sector = new Chart(sCtx, {
        type:'bar',
        data:{
          labels: sectors.map(x => x.name),
          datasets:[{
            label:'ì˜¤ëŠ˜ ë³€ë™(%)',
            data: sectors.map(x => x.changePct),
            backgroundColor: sectors.map((_,i)=> colors[Math.min(i, colors.length-1)]).map(hex => hexToRgba(hex, 0.75)),
            borderWidth: 0,
            borderRadius: 8,
            borderSkipped: false
          }]
        },
        options: {
          ...commonChartOptions,
          scales: { x: { grid: { display: false } }, y: { grid: { color: getVar('--eui-border-light') } } }
        }
      });
    }

    const topEl = document.getElementById('sectorTop');
    const botEl = document.getElementById('sectorBottom');
    const sorted = [...sectors].sort((a,b)=>b.changePct-a.changePct);
    const top3 = sorted.slice(0,3);
    const bot3 = sorted.slice(-3).reverse();
    topEl.innerHTML = top3.length ? top3.map(x => `<p>â€¢ ${escapeHtml(x.name)} <span class="text-emerald-600 font-semibold">(${fmtPct(x.changePct)})</span></p>`).join('') : `<p class="text-sm text-slate-500">ë°ì´í„° ì—†ìŒ</p>`;
    botEl.innerHTML = bot3.length ? bot3.map(x => `<p>â€¢ ${escapeHtml(x.name)} <span class="text-red-600 font-semibold">(${fmtPct(x.changePct)})</span></p>`).join('') : `<p class="text-sm text-slate-500">ë°ì´í„° ì—†ìŒ</p>`;

    // p8
    const body = document.getElementById('myStocksBody');
    const stocks = data.myStocks || [];
    body.innerHTML = stocks.length ? stocks.map(stockRow).join('') : `<tr><td class="px-6 py-4 text-sm text-slate-500" colspan="3">ë°ì´í„° ì—†ìŒ</td></tr>`;

    // p9
    document.getElementById('riskSpeed').textContent = data.risk?.speed || '-';
    document.getElementById('riskVol').textContent   = data.risk?.vol || '-';
    document.getElementById('riskRule').textContent  = data.risk?.rule || '-';
  }

  function sampleData(){
    const now = new Date();
    const kst = new Date(now.getTime() + 9*60*60*1000).toISOString().replace('T',' ').slice(0,16) + ' KST';
    const labels = Array.from({length: 30}, (_,i)=>`D-${29-i}`);
    return {
      updatedAt: kst,
      oneLine: 'ìƒ˜í”Œ: ê¸ˆë¦¬ ë³´í•©, ë‹¬ëŸ¬ ì•½ì„¸ â†’ ê¸°ìˆ ì£¼ì— ì•½ê°„ ìš°í˜¸(ì˜ˆì‹œ)',
      mood: { value: 'ì• ë§¤', reason: 'ì§€ìˆ˜ëŠ” ë³´í•©ì¸ë° ì¼ì •/ì‹¤ì  ëŒ€ê¸°ë¼ ë°©í–¥ì„±ì´ ì•½í•¨' },
      action: { value: 'ê´€ë§', note: 'ì¤‘ìš” ì¼ì • ì „ì´ë¼ ë¬´ë¦¬í•œ ë§¤ìˆ˜ ê¸ˆì§€', beginnerMemo: 'â€œê´€ë§â€ë„ ì „ëµ. ì• ë§¤í• ìˆ˜ë¡ ì‰¬ëŠ” ê²Œ ì´ê¹€.' },
      overnight: { kpis: [], bigFlowReason: '-', series: { labels } },
      schedule: { econ: [], fed: [] },
      macro: { kpis: [], series: { labels } },
      newsTop5: [],
      earnings: { upcoming: [], movers: [] },
      sectors: [],
      myStocks: [],
      risk: { speed: '-', vol: '-', rule: '-' },
      todo3: ['-', '-', '-']
    };
  }

  // init
  document.getElementById('panelTitle').textContent = panelTitles['p1'];
  loadData(false);
  scheduleAutoRefreshAt9();
</script>
</body>
</html>
